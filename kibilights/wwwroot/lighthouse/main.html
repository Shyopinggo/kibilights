<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="manifest" href="/lighthouse/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lighthouse</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="localizer.js"></script>
    <script src="settings.js"></script>
</head>
<body>
    <div class="container">

        <form >
            <div class="form-group">
                <input type="text" class="form-control-plaintext bg-secondary border" placeholder="Search" id="iSearch" />
            </div>
        </form>

        <ul class="list-group" id="lgContent"></ul>

        <ul class="list-group list-group-horizontal d-flex justify-content-around fixed-bottom mx-auto">
            <li class="list-group-item btn w-100 border" id="bMain">Main</li>
            <li class="list-group-item btn w-100 border" id="bFavorites">Favorites</li>
            <li class="list-group-item btn w-100 border" id="bSettings">Settings</li>
        </ul>
    </div>

    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let accessToken = window.localStorage.getItem('access_token');
        if (!accessToken) document.location = 'index.html';

        let lang = window.localStorage.getItem('language');
        if (!lang) lang = 'en';
        $('html').attr('lang', lang);

        $('#bMain').html(Localizer.main(lang));
        $('#bFavorites').html(Localizer.favorites(lang));
        $('#bSettings').html(Localizer.settings(lang));
        $('#iSearch').attr('placeholder', Localizer.search(lang));

        $.getJSON(apiHost + '/api/lighthouse/getfacilities?access_token=' + accessToken, (data, status) => {
            if (status === 'success') {
                let content = '';
                data.forEach(d => content += '<li class="list-group-item">' + d.name + '</li>');
                $('#lgContent').html(content);
            }
        })
            .catch(error => $('#lgContent').html('<li class="list-group-item">' + error.status + '. ' + Localizer.connectionError(lang) + '</li>'));
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/lighthouse/service-worker.js').then(function (registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    console.log('ServiceWorker registration failed: ', err);
                }).catch(function (err) {
                    console.log(err)
                });
            });
        } else {
            console.log('service worker is not supported');
        }
    </script>
</body>
</html>